<project default="reports">
    <!-- Define the classpath which includes the junit.jar and the classes after compiling-->
    <target name="diagnostics" description="diagnostics">
        <diagnostics/>
    </target>

    <!-- 'basedir' seems to be the dir the buildfile is in (lib} -->
    <!-- the calling AntExecutor should set it explicitly -->

    <target name="tests">
        <mkdir dir="${basedir}/../target/test-classes"/>
        <!-- temp hack to hardcode the test jar -->
        <unjar src="cts-java-0.5.1-SNAPSHOT-tests.jar"
               dest="${basedir}/../target/test-classes"/>
        <unjar src="${basedir}/../ctk-testpack-0.5.1-SNAPSHOT.jar"
               dest="${basedir}/../target/test-classes">
            <patternset>
                <include name="lib/*.jar"/>
                <!-- exclude logging - the ant classloader seems to pick it up from ctk -->
                <exclude name="**/*slf4j*.jar"/>
                <exclude name="**/*log4j*.jar"/>
            </patternset>
        </unjar>
        <junit printsummary="on" fork="off" filtertrace="on" haltonfailure="false" showoutput="true">
            <classpath>
                <fileset dir="${basedir}/../target/test-classes/lib">
                    <include name="**/*.jar"/>
                </fileset>
                <pathelement location="${basedir}/../target/test-classes"/>
            </classpath>
            <batchtest fork="off" todir="${basedir}/../target">
                <fileset dir="${basedir}/../target/test-classes">
                    <include name="**/*IT.class"/>
                    <include name="**/IT*.class"/>
                </fileset>
            </batchtest>
            <formatter type="xml"/>
            <formatter type="brief"/>
        </junit>
    </target>

    <target name="reports" depends="tests">
        <mkdir dir="${basedir}/../target/report"/>
        <junitreport todir="${basedir}/../target/report">
            <fileset dir="${basedir}/../target">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="frames" todir="${basedir}/../target/report/html"/>
        </junitreport>
    </target>
</project>
