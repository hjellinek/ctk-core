<project default="reports">
    <!-- Define the classpath which includes the junit.jar and the classes after compiling-->
    <target name="diagnostics" description="diagnostics">
        <diagnostics/>
    </target>

    <!-- 'basedir' seems to be the dir the buildfile is in (lib} -->
    <!-- the calling AntExecutor should set it explicitly -->

    <target name="exposeTestClasses">
        <mkdir dir="${basedir}/../lib/test-classes"/>

        <unjar src="${ctk.testjar}"
               dest="${basedir}/../lib/test-classes"
               overwrite="false"/>
    </target>
    <target name="tests" depends="exposeTestClasses">
        <junit printsummary="on" fork="off" filtertrace="on"
               haltonfailure="false" showoutput="true">
            <classpath>
                <fileset dir="${basedir}/../lib/test-classes">
                    <include name="**/*.jar"/>
                </fileset>
                <pathelement location="${basedir}/../target/test-classes"/>
            </classpath>
            <batchtest fork="off" todir="${basedir}/../${ctk.todir}">
                <!-- matchstr is comma-sep string of ant-style patterns, like
                **/*IT.class,**/IT*.class -->
                <zipfileset src="${ctk.testjar}" includes="${ctk.matchstr}"/>
            </batchtest>
            <formatter type="xml"/>
            <formatter type="brief"/>
            <!-- this "formatter" just bridges junit events to the CTK log -->
            <formatter classname="org.ga4gh.ctk.TestExecListener"/>
        </junit>
    </target>

    <target name="reports" depends="tests">
        <mkdir dir="${basedir}/../${ctk.todir}/report"/>
        <junitreport todir="${basedir}/../${ctk.todir}/report">
            <fileset dir="${basedir}/../${ctk.todir}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="frames" todir="${basedir}/../${ctk.todir}/report/html">
                <param name="TITLE" expression="${ctk.reporttitle}"/>
            </report>
        </junitreport>
    </target>
</project>
